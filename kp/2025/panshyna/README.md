# Упрощенная система верификации SQL-запросов

## Описание проекта

Простая система для безопасного выполнения и верификации SQL-запросов с использованием Docker-песочницы. Основной упор на безопасность выполнения SQL и базовую верификацию.

## Архитектура системы

```
                    ┌─────────────────┐
                    │   React.js      │
                    │   Frontend      │
                    │   (Web UI)      │
                    └─────────┬───────┘
                              │ HTTP/HTTPS
                    ┌─────────▼─────────┐
                    │   FastAPI Backend │
                    │   (Единый API)    │
                    │  - REST API       │
                    │  - SQL Sandbox    │
                    │  - Верификация    │
                    │  - Логирование    │
                    └─────────┬─────────┘
                              │
                    ┌─────────▼─────────┐
                    │   SQL Sandbox     │
                    │   (Docker)        │
                    │  - Изоляция       │
                    │  - Безопасность   │
                    │  - Ограничения    │
                    │  - Автоочистка    │
                    └─────────┬─────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
┌───────▼──────┐    ┌────────▼────────┐    ┌──────▼──────┐
│ PostgreSQL   │    │     Redis       │    │   Docker    │
│ (Основная БД)│    │   (Кэш/Логи)    │    │ (Sandbox)   │
│ - Tasks      │    │ - Execution     │    │ - Containers│
│ - Verifications│  │ - Results       │    │ - Isolation │
│ - Results    │    │ - Logs          │    │ - Cleanup   │
└──────────────┘    └─────────────────┘    └─────────────┘
```

## Технологический стек

### Backend
- **Python 3.11** - основной язык
- **FastAPI** - веб-фреймворк
- **Docker** - песочница для SQL
- **PostgreSQL** - основная база данных
- **Redis** - кэширование

### Frontend
- **React.js 18** - пользовательский интерфейс
- **Material-UI** - компоненты

### Инфраструктура
- **Docker Compose V2** - контейнеризация
- **Ubuntu** - операционная система

## Ключевые особенности

1. **SQL Sandbox** - безопасное выполнение SQL в изолированных Docker контейнерах
2. **Единый Backend** - все функции в одном FastAPI приложении
3. **Встроенная Верификация** - базовый механизм проверки результатов
4. **Кэширование** - Redis для оптимизации производительности и хранения логов
5. **Детальное Логирование** - полный аудит всех операций с SQL-запросами
6. **Безопасность** - защита от SQL-инъекций и вредоносных запросов
7. **Автоматическая Очистка** - контейнеры песочницы удаляются после выполнения
8. **Мониторинг** - отслеживание производительности и статистики

## Пошаговое решение

### 1. SQL Sandbox (Песочница)
- Изолированное выполнение SQL в Docker контейнерах
- Проверка синтаксиса перед выполнением
- Ограничение ресурсов (CPU, память, время)
- Защита от опасных операций (DROP, DELETE, etc.)
- Автоматическая очистка после выполнения

### 2. Единый API Backend
- **REST API** - управление задачами, верификациями и результатами
- **SQL Sandbox Integration** - встроенная песочница для безопасного выполнения
- **Database Management** - работа с PostgreSQL для хранения данных
- **Caching** - Redis для кэширования результатов и логов
- **Logging** - детальное логирование всех операций

### 3. React Frontend
- **Dashboard** - обзор системы и статистика
- **SQL Executor** - интерфейс для выполнения SQL-запросов
- **Tasks Management** - управление задачами и их выполнение
- **Verifications** - верификация результатов SQL-запросов
- **Monitoring** - мониторинг системы и просмотр логов

## Запуск проекта

### Требования
- Ubuntu 20.04+
- Docker Engine 20.10+
- Docker Compose V2
- 2GB RAM
- 5GB свободного места

### Быстрый запуск
```bash
# Переход в директорию
cd panshyna

# Запуск системы
chmod +x start.sh
./start.sh
```

### Ручной запуск
```bash
# Создание директорий
mkdir -p data/logs data/sandbox

# Запуск всех сервисов
sudo docker compose up --build -d

# Ожидание запуска
sleep 20

# Инициализация базы данных
sudo docker compose exec backend python init_db.py
```

### Доступ к приложению
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API Documentation**: http://localhost:8000/docs
- **Health Check**: http://localhost:8000/health

## Структура проекта

```
panshyna/
├── backend/                 # FastAPI приложение с SQL песочницей
│   ├── main.py             # Основное приложение
│   ├── init_db.py          # Инициализация БД
│   ├── requirements.txt    # Python зависимости
│   └── Dockerfile          # Docker образ
├── frontend/               # React приложение
│   ├── src/
│   │   ├── components/     # React компоненты (Navbar)
│   │   ├── pages/          # Страницы (Dashboard, SQLExecutor, Tasks, Verifications, Monitoring)
│   │   ├── services/       # API клиенты
│   │   ├── App.js          # Главный компонент
│   │   └── index.js        # Точка входа
│   ├── public/             # Статические файлы
│   ├── package.json        # Node.js зависимости
│   └── Dockerfile          # Docker образ
├── database/               # SQL скрипты
│   └── init.sql            # Инициализация БД
├── data/                   # Данные (создается при запуске)
│   ├── logs/               # Логи приложения
│   └── sandbox/            # Временные файлы песочницы
├── docker-compose.yml      # Конфигурация контейнеров
├── start.sh                # Скрипт запуска для Ubuntu
└── README.md              # Документация
```

## Безопасность

- Изолированное выполнение SQL в Docker контейнерах
- Проверка синтаксиса и валидация запросов
- Защита от SQL-инъекций
- Ограничение ресурсов и времени выполнения
- Детальное логирование всех операций
- Автоматическая очистка контейнеров

## Мониторинг

- Статус выполнения SQL-запросов
- Использование ресурсов песочницы
- Кэш-статистика Redis
- Логи ошибок и предупреждений
- Метрики производительности
